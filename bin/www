#!/usr/bin/env node
// creating connection to the MPD daemon
var net = require('net');
var mpdPort = 6600;
var mpdHost = 'localhost';
var connMpdCommand = net.createConnection(mpdPort,mpdHost); // Socket to send commands and receive track listings

var mpdDirectController = require('../controllers/mpd-daemon-controller');
mpdDirectController.init(connMpdCommand);

var volumioCore = require('../controllers/core-volumio-services');
volumioCore.setMpdDaemonController(mpdDirectController);

// initializing MPD controller
var mdpControllerPort = 6500;
var mpdControllerHost = 'localhost';
//var mpdController = require('../controllers/interface-mpd')(mdpControllerPort,mpdControllerHost,connMpdCommand);
var mpdController = require('../controllers/interface-mpd')(mdpControllerPort,mpdControllerHost,volumioCore);
// initializing the main server module
var main = require('../server');
var app = main.app;
app.set('port', 3000);
var server = app.listen(app.get('port'), function() {
	  console.log('Express server listening on port ' + server.address().port);
});
// attaching socket io to our module
var socketIo = require('socket.io')(server);
// creating a connection to the MPD controller
var connMpdInterface = net.createConnection(mdpControllerPort, mpdControllerHost);
// and passing it to our client controller
var clientMpdController = require('../controllers/interface-webUI')(socketIo,volumioCore);